# 质量等于生命

## 提高代码质量的重要性

- 代码的可读性会好很多，可维护性会更好
- 高质量的代码可以避免很多隐形的 bug
- 增加新的需求，实现起来相对更加容易，开发效率会更高
- reuse 的难度相对降低
- 很多时候，我们只能通过代码去学习实现逻辑，劣质的代码会浪费我们很多的时间，让我们学习过程中产生很多障碍
- 降低公司成本

## 学习资源

### 代码优化重构相关的书籍

- 学习优化代码的一些方法，和重构代码的思想
- 相关的书籍有：
  - 《代码大全》
  - 《代码整洁之道》
  - 《程序员修炼之道：从小工到专家》
  - 《设计模式》
  - 《重构》
  - 《编程卓越之道》
  - 《代码优化:有效使用内存》

### 网络资源

- 卡内基梅隆大学软件工程学院编程规范
  - [SEI CERT C Coding Standard](https://wiki.sei.cmu.edu/confluence/display/c/SEI+CERT+C+Coding+Standard)
  - [SEI CERT C++ Coding Standard](https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046682)

### 参考资料

- [misra-c-1998](doc/misra-c-1998.pdf)
- [misra-c-2004](doc/misra-c-2004.pdf)
- [misra-c-2012-amd-1](doc/misra-c-2012-amd-1.pdf)
- [高质量 C 语言编程思想](doc/高质量C语言编程思想.doc)

## 使用代码静态扫描工具

### 静态代码分析工具的优势

- 帮助程序开发人员自动执行静态代码分析，快速定位代码隐藏错误和缺陷。
- 帮助代码设计人员更专注于分析和解决代码设计缺陷。
- 显著减少在代码逐行检查上花费的时间，提高软件可靠性并节省软件开发和测试成本。

### [SonarQube 代码扫描](https://www.sonarqube.org/)

- SonarQube 有非常多的规则可以使用，可以快速分析代码问题并生成问题列表，效率非常的高

### [PC-Lint 代码扫描](https://www.gimpel.com/)

- PC-Lint 是一款优秀的代码扫描工具

## Google Test

- Googletest - Google Testing and Mocking Framework
- [github repo 页面地址](https://github.com/google/googletest)

## 代码规则

### 不要使用魔数字

- 用宏定义定义魔数字，宏定义最好能清楚表达魔数字的含义
- 用 enum 枚举变量，同样命名要能表达一定的含义

### 非运算符!应该只用来操作 bool 型变量

### 运算尽可能多的用()

- 尤其是运算比较复杂时，一定要把括号加上去
- 涉及到优先级的问题时，一定要把括号加上去，并不是所有人对优先级很清楚

### 控制重复的代码

- 降低代码冗余度，相似的功能要封装成函数，避免修改代码时，只修改了一个地方，忘了另外一个地方

### 代码每行不超过 80 个字符

- 用工具可以格式化一行超过 80 个字符的问题

### 代码对齐

- 有很多工具都可以帮助我们格式化代码
- 代码对齐后，让人感觉代码就像一门艺术

### 不用 tab 键

- tab 键在不同的代码编辑工具会有对齐问题

### 注释

- 代码不仅是完成功能，也是写给别人看的，给别人 reuse 的
- 写好注释是优质代码必不可少的评判标准

### 用不到的代码要删除

- 垃圾代码一定要删除，否则会让后来人很迷茫

### 降低代码嵌套层数

- 使用卫语句减少 if/else/for/while 嵌套过深

## 哪些提高代码质量的方法是工具帮不了我们的

### 要写简单的代码

- 要用最简单的代码表达复杂的问题
- 代码意思要清晰，容易理解

### 要善于对变量及函数命名

- 命名好的话，可以少写很多注释
- 清晰表达变量的含义

### 善于使用 static 关键字

- 本地化变量和代码范围的好处

### 善于使用 const 关键字

- 告诉编译器更丰富的信息

### volatile 的使用方法必知

- 没有用 volatile 有时候是非常危险的

### 少用全局变量

- 全局变量太多，耦合度太高，代码质量就不好说了

### 合理地写注释

- 注释应当叙述清晰

### 一个工程要有一个公用的头文件

- 将一些头文件包含放到同一个头文件，这样会减少很多因头文件包含导致的编译问题，除非你要凑代码行数
- 将一些宏定义统一放到一个头文件，查找和修改都方便

### 要写可移植的代码

- 可移植性高的代码，可以降低 reuse 的难度
- 可移植性高的代码，可读性一定也是非常高的

### 写可重入的代码

- 不可重入的代码是比较危险的

### 中断服务程序

- 中断程序不应该做太多事情，复杂的活交给主程序干
- 在实时系统中，中断应该仅仅是发送信号量给相应的任务去处理复杂的活

### 单元测试

- 有效的单元测试可以快速减少简单的一些错误
